
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>(Tut 1) Deep Learning Deep Inelastic Scattering at EIC &#8212; HUGS 2025 - Artificial Intelligence for Nuclear Physics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "cfteach/HUGS2025");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "💬 comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'NN_h1_reg_CF_2025';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="canonical" href="https://cfteach.github.io/HUGS2025/NN_h1_reg_CF_2025.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Convolutional Neural Network - Part 1" href="CNN_HUGS2025_01.html" />
    <link rel="prev" title="AI/ML for Nuclear Physics HUGS 2025" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">This page is being updated</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo_2025.pdf" class="logo__image only-light" alt="HUGS 2025 - Artificial Intelligence for Nuclear Physics - Home"/>
    <script>document.write(`<img src="_static/logo_2025.pdf" class="logo__image only-dark" alt="HUGS 2025 - Artificial Intelligence for Nuclear Physics - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    AI/ML for Nuclear Physics HUGS 2025
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1eFXv0KlBtPr8G8Aw_aDlZOIOHUPEuvzn/view?usp=share_link">(Lec 1, part A) A Brief Introduction to AI/ML</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1A39DZNMuUvabV8XyhJ2VSt4CYkNUEMxs/view?usp=share_link">(Lec 1, part B) AI/ML in Nuclear Physics</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.google.com/presentation/d/1GlcFOsytJsw6B0k8AXwuswUiuU8LYySbRgrC3bkRmhY/edit?usp=sharing">(Lec 2) CNN for Physics  by K. Suresh</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">(Old) Lectures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1ySR6KmDs7PM1tVcDYuQwvt0wXuv0WIyS/view">(Lec 1) AI/ML for Nuclear Physics - A High-Bias, Low-Variance Introduction</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1kjGhjYMtmQIz42_fRNfoudC7UoSUMS7t/view">(Lec 2) Leveraging AI/ML for the future Electron Ion Collider</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1e0-qNQUldvUZEKib367nltQgqNBNf9LJ/view">(Lec 2, extra) AI/ML activities at Jefferson Lab - Paving the way for the Electron Ion Collider</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/19tPr009whWgTjSlm9yUSWsUcs62UWjye/view">(Lec 3) ePIC at EIC – The First Large-Scale Experiment Designed with the AI Assistance</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">(Lec 1) Deeply Learning Deep Inelastic Scattering</a></li>
<li class="toctree-l1"><a class="reference internal" href="CNN_HUGS2025_01.html">(Lec 2) CNN - Part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="CNN_HUGS2025_02.html">(Lec 2) CNN - Part 2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/drive/folders/1EyMKnJMEmBGZ-BRNbebIfpfI7j1OywqD?usp=share_link">(Lec 2) Dataset</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">(Old) Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="NeuralNetwork_preflight.html">(Tut 1) "Pre-flight"</a></li>
<li class="toctree-l1"><a class="reference internal" href="exe3a_moo_EA_3obj.html">(Tut 2 - part a) AI-assisted design with MOEA</a></li>
<li class="toctree-l1"><a class="reference internal" href="exe3b_moo_BO_3obj.html">(Tut 2 - part b) AI-assisted design with MOBO</a></li>
<li class="toctree-l1"><a class="reference external" href="https://eic.ai/community">AI4EIC tutorials</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">[Pre-flight]</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://docs.google.com/presentation/d/1BV2-N-c1bq4yx1IsPMW4fhC9i1SCdRAU/edit?usp=sharing&amp;ouid=113195593718692427789&amp;rtpof=true&amp;sd=true"> Intro to Modeling, Linear Regression (lecture slides)</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Day-1/GIT-course/intro_to_git.html">1. Brief course on <code class="docutils literal notranslate"><span class="pre">git</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/VCS.html">1.1. Version Control System (VCS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/git_basics.html">1.2. What is Git?</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/git_configure.html">1.3. Configuring your <code class="docutils literal notranslate"><span class="pre">git</span></code></a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Day-1/GIT-course/git_exercises.html">2. Exercises on <code class="docutils literal notranslate"><span class="pre">git</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/Exercise-1.html">2.1. Exercise 1: Basic Git Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/Exercise-2.html">2.2. Exercise 2: Commits, push and branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/Exercise-3.html">2.3. Advanced exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/GIT-course/Exercise-4.html">2.4. GitHub Actions and Workflow Tutorial</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="Day-1/VS-code.html">3. Installing Visual Studio Code</a></li>


<li class="toctree-l1 has-children"><a class="reference internal" href="Day-1/HPC-course/intro_to_HPC_HTC.html">6. Introduction to High Performance Computing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Day-1/HPC-course/intro_to_HPC.html">6.1. High Performance Computing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/HPC-course/ssh_login.html">6.2. SSH into a Front-End Node Using Proxy Jump</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/HPC-course/file_systems_WM.html">6.3. William &amp; Mary Research Computing: File Systems Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="Day-1/HPC-course/SLURM_commands2.html">6.4. Introduction to SLURM</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Other References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Intro_DS.html">Introduction to Data Science (beginners)</a></li>
<li class="toctree-l1"><a class="reference internal" href="EIC-Visualization.html">Interactively Navigate the Pareto Front of the EIC Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="EIC-Summary.html">EIC Overview</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Datasets / Modules</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1Z-lUTZrHoqeKsYHf34gR3kF45bVM6XG7/view">(Lec 1) all-h1-rapgap.root</a></li>
<li class="toctree-l1"><a class="reference external" href="https://raw.githubusercontent.com/cfteach/HUGS23/main/other/intro_Data.py">(Lec 1) intro_Data.py</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/drive/folders/1EyMKnJMEmBGZ-BRNbebIfpfI7j1OywqD?usp=share_link">(Lec 2) Dataset</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Additional resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="referencesmc.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/cfteach/HUGS2025/blob/webpage-src/source_material/NN_h1_reg_CF_2025.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cfteach/HUGS2025" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cfteach/HUGS2025/edit/webpage-src/source_material/NN_h1_reg_CF_2025.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cfteach/HUGS2025/issues/new?title=Issue%20on%20page%20%2FNN_h1_reg_CF_2025.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/NN_h1_reg_CF_2025.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>(Tut 1) Deep Learning Deep Inelastic Scattering at EIC</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-for-h1-rapgap-mc-with-reconstructed-observables-as-input">Training for H1 rapgap MC with reconstructed observables as input.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#this-uses-a-single-dnn-with-all-inputs-electron-hfs-photons">This uses a single DNN with all inputs (electron, HFS, photons)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-any-event-selection-here">Apply any event selection here.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-machine-learning">Set up machine learning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-the-regression-network">Set up the regression network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-ratio-pred-true-for-target-variables-transformed-log-x-log-y-and-log-q2">Plots of Ratio(pred/true) for target variables : transformed log(x), log(y), and log(Q2)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-predicted-and-true-physics-variable-x">Plots of predicted and true physics variable : x</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-predicted-and-true-physics-variable-q2">Plots of predicted and true physics variable : Q2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-predicted-and-true-physics-variable-y">Plots of predicted and true physics variable : y</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-pred-true-of-physics-variable-x">Plots of pred/true of physics variable x</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-pred-true-of-physics-variable-q2">Plots of pred/true of physics variable Q2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-pred-true-of-physics-variable-y">Plots of pred/true of physics variable y</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-plots-of-resolution-for-methods-vs-dnn">Comparison plots of resolution for methods vs DNN</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resolution-in-x">Resolution in x</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resolution-in-q2">Resolution in Q2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resolution-in-y">Resolution in y</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-results-as-a-function-of-y">Plotting the results as a function of y</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tut-1-deep-learning-deep-inelastic-scattering-at-eic">
<h1>(Tut 1) Deep Learning Deep Inelastic Scattering at EIC<a class="headerlink" href="#tut-1-deep-learning-deep-inelastic-scattering-at-eic" title="Link to this heading">#</a></h1>
<p><strong>Credits:</strong></p>
<p>Heavily based on:</p>
<ul class="simple">
<li><p><em>Reconstructing the Kinematics of Deep Inelastic Scattering with Deep Learning</em> by Miguel Arratia, Daniel Britzger, Owen Long, Benjamin Nachman arXiv:2110.05505 — [<a class="reference external" href="https://github.com/owen234/DIS-reco-paper">code</a>, <a class="reference external" href="https://drive.google.com/file/d/1Z-lUTZrHoqeKsYHf34gR3kF45bVM6XG7/view">dataset</a>]</p></li>
<li><p><em>Deeply Learning Deep Inelastic Scattering Kinematics</em>, by Markus Diefenthaler, Abdullah Farhat, Andrii Verbytskyi, Yuesheng Xu,arXiv:2108.11638</p></li>
</ul>
<section id="training-for-h1-rapgap-mc-with-reconstructed-observables-as-input">
<h2>Training for H1 rapgap MC with reconstructed observables as input.<a class="headerlink" href="#training-for-h1-rapgap-mc-with-reconstructed-observables-as-input" title="Link to this heading">#</a></h2>
<section id="this-uses-a-single-dnn-with-all-inputs-electron-hfs-photons">
<h3>This uses a single DNN with all inputs (electron, HFS, photons)<a class="headerlink" href="#this-uses-a-single-dnn-with-all-inputs-electron-hfs-photons" title="Link to this heading">#</a></h3>
<p>Adjust Huber delta to 0.01.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mounted at /content/drive
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make sure GPU runtime is enabled.</span>
<span class="c1"># Runtime -&gt; Change Runtime Type -&gt; Hardware Accelerator -&gt; GPU</span>
<span class="c1"># You will likely only have a T4, unless you have colab pro.</span>
<span class="o">!</span>nvidia-smi
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tue May 27 04:39:19 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 550.54.15              Driver Version: 550.54.15      CUDA Version: 12.4     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  Tesla T4                       Off |   00000000:00:04.0 Off |                    0 |
| N/A   45C    P8              9W /   70W |       0MiB /  15360MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We need uproot to unpack the ROOT file.</span>
<span class="c1">#!pip uninstall -y uproot3</span>
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>uproot
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found existing installation: uproot3 3.14.4
Uninstalling uproot3-3.14.4:
  Successfully uninstalled uproot3-3.14.4
Collecting uproot
  Downloading uproot-5.6.2-py3-none-any.whl.metadata (33 kB)
Collecting awkward&gt;=2.4.6 (from uproot)
  Downloading awkward-2.8.3-py3-none-any.whl.metadata (7.0 kB)
Requirement already satisfied: cramjam&gt;=2.5.0 in /usr/local/lib/python3.11/dist-packages (from uproot) (2.10.0)
Requirement already satisfied: fsspec in /usr/local/lib/python3.11/dist-packages (from uproot) (2025.3.2)
Requirement already satisfied: numpy in /usr/local/lib/python3.11/dist-packages (from uproot) (2.0.2)
Requirement already satisfied: packaging in /usr/local/lib/python3.11/dist-packages (from uproot) (24.2)
Requirement already satisfied: xxhash in /usr/local/lib/python3.11/dist-packages (from uproot) (3.5.0)
Collecting awkward-cpp==46 (from awkward&gt;=2.4.6-&gt;uproot)
  Downloading awkward_cpp-46-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (2.1 kB)
Requirement already satisfied: importlib-metadata&gt;=4.13.0 in /usr/local/lib/python3.11/dist-packages (from awkward&gt;=2.4.6-&gt;uproot) (8.7.0)
Requirement already satisfied: zipp&gt;=3.20 in /usr/local/lib/python3.11/dist-packages (from importlib-metadata&gt;=4.13.0-&gt;awkward&gt;=2.4.6-&gt;uproot) (3.21.0)
Downloading uproot-5.6.2-py3-none-any.whl (375 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">375.7/375.7 kB</span> <span class=" -Color -Color-Red">15.0 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hDownloading awkward-2.8.3-py3-none-any.whl (886 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">886.1/886.1 kB</span> <span class=" -Color -Color-Red">42.5 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hDownloading awkward_cpp-46-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (638 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">638.7/638.7 kB</span> <span class=" -Color -Color-Red">50.1 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hInstalling collected packages: awkward-cpp, awkward, uproot
Successfully installed awkward-2.8.3 awkward-cpp-46 uproot-5.6.2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pip</span> install awkward-pandas
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting awkward-pandas
  Using cached awkward_pandas-2023.8.0-py3-none-any.whl.metadata (2.1 kB)
Requirement already satisfied: awkward&gt;=2.0.0 in /usr/local/lib/python3.11/dist-packages (from awkward-pandas) (2.8.3)
Requirement already satisfied: pandas&gt;=1.2 in /usr/local/lib/python3.11/dist-packages (from awkward-pandas) (2.2.2)
Requirement already satisfied: awkward-cpp==46 in /usr/local/lib/python3.11/dist-packages (from awkward&gt;=2.0.0-&gt;awkward-pandas) (46)
Requirement already satisfied: fsspec&gt;=2022.11.0 in /usr/local/lib/python3.11/dist-packages (from awkward&gt;=2.0.0-&gt;awkward-pandas) (2025.3.2)
Requirement already satisfied: importlib-metadata&gt;=4.13.0 in /usr/local/lib/python3.11/dist-packages (from awkward&gt;=2.0.0-&gt;awkward-pandas) (8.7.0)
Requirement already satisfied: numpy&gt;=1.18.0 in /usr/local/lib/python3.11/dist-packages (from awkward&gt;=2.0.0-&gt;awkward-pandas) (2.0.2)
Requirement already satisfied: packaging in /usr/local/lib/python3.11/dist-packages (from awkward&gt;=2.0.0-&gt;awkward-pandas) (24.2)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /usr/local/lib/python3.11/dist-packages (from pandas&gt;=1.2-&gt;awkward-pandas) (2.9.0.post0)
Requirement already satisfied: pytz&gt;=2020.1 in /usr/local/lib/python3.11/dist-packages (from pandas&gt;=1.2-&gt;awkward-pandas) (2025.2)
Requirement already satisfied: tzdata&gt;=2022.7 in /usr/local/lib/python3.11/dist-packages (from pandas&gt;=1.2-&gt;awkward-pandas) (2025.2)
Requirement already satisfied: zipp&gt;=3.20 in /usr/local/lib/python3.11/dist-packages (from importlib-metadata&gt;=4.13.0-&gt;awkward&gt;=2.0.0-&gt;awkward-pandas) (3.21.0)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.11/dist-packages (from python-dateutil&gt;=2.8.2-&gt;pandas&gt;=1.2-&gt;awkward-pandas) (1.17.0)
Using cached awkward_pandas-2023.8.0-py3-none-any.whl (11 kB)
Installing collected packages: awkward-pandas
Successfully installed awkward-pandas-2023.8.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">mticker</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rc</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">inf</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>


<span class="kn">import</span> <span class="nn">uproot</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#has_gpu = False</span>

<span class="n">has_gpu</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">training_name</span> <span class="o">=</span> <span class="s1">&#39;training_h1_reg_hugs25_v1&#39;</span>

<span class="c1">#training_extname = &quot;/content/drive/My Drive/projects/DIS-reco/DIS-reco-paper/&quot;+training_name</span>

<span class="n">saving_dir</span> <span class="o">=</span> <span class="s2">&quot;/content/drive/My Drive/TMP/&quot;</span>

<span class="n">training_extname</span> <span class="o">=</span> <span class="n">saving_dir</span><span class="o">+</span><span class="n">training_name</span>


<span class="c1">#--- Hyperparameter settings.</span>

<span class="c1">#max_events =   120000</span>
<span class="c1">#max_events =   600000</span>
<span class="n">max_events</span> <span class="o">=</span> <span class="mf">10e6</span>
<span class="c1">#max_events =  3000000</span>
<span class="c1">#max_events = 15000000</span>


<span class="n">learning_rate_setval_reg</span> <span class="o">=</span> <span class="mf">1e-5</span>
<span class="n">batch_size_setval</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">max_epochs</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">dropout_setval</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">amsgrad_setval</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">delta_setval</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="c1"># Path to the ROOT file in your google drive. Make sure your drive is mounted above.</span>
<span class="c1">#input_file = &#39;/content/drive/My Drive/projects/DIS-reco/data/all-h1-rapgap.root&#39;</span>

<span class="c1">#input_url = &#39;https://drive.google.com/file/d/1Z-lUTZrHoqeKsYHf34gR3kF45bVM6XG7/view&#39;</span>

<span class="n">input_id</span> <span class="o">=</span> <span class="s1">&#39;1Z-lUTZrHoqeKsYHf34gR3kF45bVM6XG7&#39;</span>
<span class="n">input_url</span> <span class="o">=</span> <span class="s1">&#39;https://drive.google.com/uc?id=&#39;</span><span class="o">+</span><span class="n">input_id</span>


<span class="n">outprintfile</span> <span class="o">=</span> <span class="n">training_extname</span><span class="o">+</span><span class="s2">&quot;-setup.txt&quot;</span>

<span class="n">parfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outprintfile</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

<span class="n">parfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
<span class="n">parfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;training_name : </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">training_extname</span> <span class="p">)</span>
<span class="n">parfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;input_file : </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">input_id</span> <span class="p">)</span> <span class="c1">#input_file</span>
<span class="n">parfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;max_events : </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">max_events</span> <span class="p">)</span>
<span class="n">parfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;learning_rate_setval_reg : </span><span class="si">%g</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">learning_rate_setval_reg</span> <span class="p">)</span>
<span class="n">parfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;batch_size_setval : </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">batch_size_setval</span> <span class="p">)</span>
<span class="n">parfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;max_epochs : </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">max_epochs</span> <span class="p">)</span>
<span class="n">parfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;dropout_setval : </span><span class="si">%g</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">dropout_setval</span> <span class="p">)</span>
<span class="n">parfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;amsgrad_setval : </span><span class="si">%g</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">amsgrad_setval</span> <span class="p">)</span>
<span class="n">parfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;delta_setval : </span><span class="si">%g</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">delta_setval</span> <span class="p">)</span>

<span class="n">parfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">command_string</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;cat &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">%</span> <span class="n">outprintfile</span>

<span class="nb">print</span><span class="p">(</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="n">command_string</span><span class="p">)</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-05-27 05:28:30.764762
training_name : /content/drive/My Drive/TMP/training_h1_reg_hugs25_v1
input_file : 1Z-lUTZrHoqeKsYHf34gR3kF45bVM6XG7
max_events : 10000000
learning_rate_setval_reg : 1e-05
batch_size_setval : 1024
max_epochs : 50
dropout_setval : 0
amsgrad_setval : 0
delta_setval : 0.01
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pip</span> install -q gdown
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>gdown<span class="w"> </span>--id<span class="w"> </span>1Z-lUTZrHoqeKsYHf34gR3kF45bVM6XG7<span class="w"> </span>--output<span class="w"> </span>myfile.root
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.11/dist-packages/gdown/__main__.py:140: FutureWarning: Option `--id` was deprecated in version 4.3.1 and will be removed in 5.0. You don&#39;t need to pass it anymore to use a file ID.
  warnings.warn(
Downloading...
From (original): https://drive.google.com/uc?id=1Z-lUTZrHoqeKsYHf34gR3kF45bVM6XG7
From (redirected): https://drive.google.com/uc?id=1Z-lUTZrHoqeKsYHf34gR3kF45bVM6XG7&amp;confirm=t&amp;uuid=0faca380-f948-40d0-abaf-6b1615044e84
To: /content/myfile.root
100% 6.51G/6.51G [01:01&lt;00:00, 106MB/s]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>head<span class="w"> </span>-c<span class="w"> </span><span class="m">20</span><span class="w"> </span>myfile.root
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<pre class="output stream literal-block">root5Ad�$N</pre>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="c1">#ur_file = uproot3.open(input_file)</span>
<span class="n">ur_file</span> <span class="o">=</span> <span class="n">uproot</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;myfile.root&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ur_file.keys(): &quot;</span><span class="p">,</span> <span class="n">ur_file</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">ur_tree</span> <span class="o">=</span> <span class="n">ur_file</span><span class="p">[</span><span class="s1">&#39;Rapgap/minitree&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ur_tree</span><span class="p">)</span>
<span class="n">ur_tree</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#pandas_df   =  ur_tree.pandas.df([&#39;*&#39;], entrystop=max_events,flatten=True)</span>
<span class="n">pandas_df</span> <span class="o">=</span> <span class="n">ur_tree</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s1">&#39;has_isr&#39;</span><span class="p">,</span> <span class="s1">&#39;has_fsr&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tower_sum_40&#39;</span><span class="p">,</span> <span class="s1">&#39;n_towers_40&#39;</span><span class="p">,</span>
        <span class="s1">&#39;eta_pho_closest_to_ebeam&#39;</span><span class="p">,</span> <span class="s1">&#39;e_pho_closest_to_ebeam&#39;</span><span class="p">,</span> <span class="s1">&#39;phi_pho_closest_to_ebeam&#39;</span><span class="p">,</span>
        <span class="s1">&#39;obs_x&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_y&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_Q2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;from_tlv_gen_Q2&#39;</span><span class="p">,</span> <span class="s1">&#39;from_tlv_gen_x&#39;</span><span class="p">,</span> <span class="s1">&#39;from_tlv_gen_y&#39;</span><span class="p">,</span>
        <span class="s1">&#39;obs_e_e&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_e_pz&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_e_pt&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_e_phi&#39;</span><span class="p">,</span>
        <span class="s1">&#39;obs_hfs_e&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_hfs_pz&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_hfs_pt&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_hfs_phi&#39;</span><span class="p">,</span>
        <span class="s1">&#39;obs_dphi&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Empz&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_e_trk_e&#39;</span><span class="p">,</span>
        <span class="s1">&#39;beam_e_e&#39;</span>
    <span class="p">],</span>
    <span class="n">entry_stop</span><span class="o">=</span><span class="n">max_events</span><span class="p">,</span>
    <span class="n">library</span><span class="o">=</span><span class="s2">&quot;pd&quot;</span>
<span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> Number of entries in pandas_df:  </span><span class="si">%d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">pandas_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ur_file.keys():  [&#39;Rapgap;1&#39;, &#39;Rapgap/minitree;1&#39;, &#39;Rapgap/DISEvent;1&#39;, &#39;Rapgap/DISEvent/13_1_before_cuts;1&#39;, &#39;Rapgap/DISEvent/13_1_before_cuts_lxy;1&#39;, &#39;Rapgap/DISEvent/13_2_detector_cuts;1&#39;, &#39;Rapgap/DISEvent/13_2_detector_cuts_lxy;1&#39;]
&lt;TTree &#39;minitree&#39; (42 branches) at 0x7a1f7d93b510&gt;
name                 | typename                 | interpretation                
---------------------+--------------------------+-------------------------------
wgt                  | float                    | AsDtype(&#39;&gt;f4&#39;)
Empz                 | float                    | AsDtype(&#39;&gt;f4&#39;)
from_tlv_gen_Q2      | float                    | AsDtype(&#39;&gt;f4&#39;)
from_tlv_gen_x       | float                    | AsDtype(&#39;&gt;f4&#39;)
from_tlv_gen_y       | float                    | AsDtype(&#39;&gt;f4&#39;)
beam_e_e             | float                    | AsDtype(&#39;&gt;f4&#39;)
beam_p_e             | float                    | AsDtype(&#39;&gt;f4&#39;)
has_isr              | int8_t                   | AsDtype(&#39;int8&#39;)
has_fsr              | int8_t                   | AsDtype(&#39;int8&#39;)
gen_e_e              | float                    | AsDtype(&#39;&gt;f4&#39;)
gen_e_pz             | float                    | AsDtype(&#39;&gt;f4&#39;)
gen_e_pt             | float                    | AsDtype(&#39;&gt;f4&#39;)
gen_e_phi            | float                    | AsDtype(&#39;&gt;f4&#39;)
gen_e_eta            | float                    | AsDtype(&#39;&gt;f4&#39;)
gen_hfs_e            | float                    | AsDtype(&#39;&gt;f4&#39;)
gen_hfs_pz           | float                    | AsDtype(&#39;&gt;f4&#39;)
gen_hfs_pt           | float                    | AsDtype(&#39;&gt;f4&#39;)
gen_hfs_phi          | float                    | AsDtype(&#39;&gt;f4&#39;)
gen_hfs_eta          | float                    | AsDtype(&#39;&gt;f4&#39;)
gen_dphi             | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_e_e              | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_e_pz             | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_e_pt             | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_e_phi            | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_e_eta            | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_hfs_e            | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_hfs_pz           | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_hfs_pt           | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_hfs_phi          | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_hfs_eta          | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_dphi             | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_x                | float[9]                 | AsDtype(&quot;(&#39;&gt;f4&#39;, (9,))&quot;)
obs_y                | float[9]                 | AsDtype(&quot;(&#39;&gt;f4&#39;, (9,))&quot;)
obs_Q2               | float[9]                 | AsDtype(&quot;(&#39;&gt;f4&#39;, (9,))&quot;)
phi_pho_closest_t... | float                    | AsDtype(&#39;&gt;f4&#39;)
eta_pho_closest_t... | float                    | AsDtype(&#39;&gt;f4&#39;)
e_pho_closest_to_... | float                    | AsDtype(&#39;&gt;f4&#39;)
tower_sum_40         | float                    | AsDtype(&#39;&gt;f4&#39;)
n_towers_40          | int32_t                  | AsDtype(&#39;&gt;i4&#39;)
obs_e_trk_e          | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_e_trk_eta        | float                    | AsDtype(&#39;&gt;f4&#39;)
obs_e_trk_phi        | float                    | AsDtype(&#39;&gt;f4&#39;)


 Number of entries in pandas_df:  10000000 
CPU times: user 11.1 s, sys: 4.82 s, total: 15.9 s
Wall time: 18.6 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pandas_df</span><span class="p">))</span>
<span class="n">pandas_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10000000
</pre></div>
</div>
<div class="output text_html">
  <div id="df-2d2b4799-2199-48dc-9de3-70a27da97003" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>has_isr</th>
      <th>has_fsr</th>
      <th>tower_sum_40</th>
      <th>n_towers_40</th>
      <th>eta_pho_closest_to_ebeam</th>
      <th>e_pho_closest_to_ebeam</th>
      <th>phi_pho_closest_to_ebeam</th>
      <th>obs_x</th>
      <th>obs_y</th>
      <th>obs_Q2</th>
      <th>...</th>
      <th>obs_e_pt</th>
      <th>obs_e_phi</th>
      <th>obs_hfs_e</th>
      <th>obs_hfs_pz</th>
      <th>obs_hfs_pt</th>
      <th>obs_hfs_phi</th>
      <th>obs_dphi</th>
      <th>Empz</th>
      <th>obs_e_trk_e</th>
      <th>beam_e_e</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>27.6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>27.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>27.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>27.6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>27.6</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 25 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-2d2b4799-2199-48dc-9de3-70a27da97003')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-2d2b4799-2199-48dc-9de3-70a27da97003 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-2d2b4799-2199-48dc-9de3-70a27da97003');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-db85ff28-e287-4720-9907-b5a600c2bfcd">
      <button class="colab-df-quickchart" onclick="quickchart('df-db85ff28-e287-4720-9907-b5a600c2bfcd')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-db85ff28-e287-4720-9907-b5a600c2bfcd button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas_df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-32a0f74e-0432-4513-9232-29dab93ae753" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>has_isr</th>
      <th>has_fsr</th>
      <th>tower_sum_40</th>
      <th>n_towers_40</th>
      <th>eta_pho_closest_to_ebeam</th>
      <th>e_pho_closest_to_ebeam</th>
      <th>phi_pho_closest_to_ebeam</th>
      <th>obs_x</th>
      <th>obs_y</th>
      <th>obs_Q2</th>
      <th>...</th>
      <th>obs_e_pt</th>
      <th>obs_e_phi</th>
      <th>obs_hfs_e</th>
      <th>obs_hfs_pz</th>
      <th>obs_hfs_pt</th>
      <th>obs_hfs_phi</th>
      <th>obs_dphi</th>
      <th>Empz</th>
      <th>obs_e_trk_e</th>
      <th>beam_e_e</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9999995</th>
      <td>1</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>27.6</td>
    </tr>
    <tr>
      <th>9999996</th>
      <td>0</td>
      <td>1</td>
      <td>47.094521</td>
      <td>2</td>
      <td>-0.124716</td>
      <td>8.941693</td>
      <td>2.411923</td>
      <td>[0.058499809354543686 0.05831887200474739 0.05...</td>
      <td>[0.4024747610092163 0.4050461947917938 0.40504...</td>
      <td>[2391.388916015625 2399.22412109375 2381.09741...</td>
      <td>...</td>
      <td>37.800995</td>
      <td>2.692896</td>
      <td>119.429268</td>
      <td>97.070717</td>
      <td>37.856754</td>
      <td>-0.424569</td>
      <td>3.117465</td>
      <td>55.341942</td>
      <td>39.459339</td>
      <td>27.6</td>
    </tr>
    <tr>
      <th>9999997</th>
      <td>0</td>
      <td>0</td>
      <td>17.333700</td>
      <td>1</td>
      <td>-0.806077</td>
      <td>0.196039</td>
      <td>0.073661</td>
      <td>[0.004271071404218674 0.002905079396441579 0.0...</td>
      <td>[0.43371501564979553 0.4118492603302002 0.4118...</td>
      <td>[188.14749145507812 121.5215835571289 195.4123...</td>
      <td>...</td>
      <td>10.322068</td>
      <td>-2.546395</td>
      <td>49.432240</td>
      <td>26.698160</td>
      <td>10.748409</td>
      <td>0.720433</td>
      <td>3.016356</td>
      <td>53.993011</td>
      <td>16.515560</td>
      <td>27.6</td>
    </tr>
    <tr>
      <th>9999998</th>
      <td>1</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>27.6</td>
    </tr>
    <tr>
      <th>9999999</th>
      <td>0</td>
      <td>1</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>27.6</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 25 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-32a0f74e-0432-4513-9232-29dab93ae753')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-32a0f74e-0432-4513-9232-29dab93ae753 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-32a0f74e-0432-4513-9232-29dab93ae753');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-6a181f2b-2273-4cf1-83cf-cad62b3b0abb">
      <button class="colab-df-quickchart" onclick="quickchart('df-6a181f2b-2273-4cf1-83cf-cad62b3b0abb')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-6a181f2b-2273-4cf1-83cf-cad62b3b0abb button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;obs_hfs_Empz = obs_hfs_e - obs_hfs_pz&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;obs_e_Empz = obs_e_e - obs_e_pz&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>

<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;obs_event_Empz = obs_hfs_Empz + obs_e_Empz&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>

<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;rot_pt1 = 0.70710678 * obs_hfs_pt - 0.70710678 * obs_e_pt&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;rot_pt2 = 0.70710678 * obs_hfs_pt + 0.70710678 * obs_e_pt&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>

<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;rot_Empz1 = 0.70710678 * obs_hfs_Empz - 0.70710678 * obs_e_Empz&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;rot_Empz2 = 0.70710678 * obs_hfs_Empz + 0.70710678 * obs_e_Empz&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>

<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;gen_log_x = log(from_tlv_gen_x)&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;gen_log_y = log(from_tlv_gen_y)&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;gen_log_Q2 = log(from_tlv_gen_Q2)&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>

<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;e_ecal_over_trk_ratio = tower_sum_40/obs_e_trk_e&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;e_ecal_over_trk_ratio = (e_ecal_over_trk_ratio&lt;4)*e_ecal_over_trk_ratio + (e_ecal_over_trk_ratio&gt;4)*4&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>

<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;dphi_pho_closest_to_ebeam = obs_e_phi - phi_pho_closest_to_ebeam&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;dphi_pho_closest_to_ebeam = (abs(dphi_pho_closest_to_ebeam)&lt;3.14159265)*(dphi_pho_closest_to_ebeam)+(dphi_pho_closest_to_ebeam&gt;3.14159265)*(dphi_pho_closest_to_ebeam-2*3.14159265) + (dphi_pho_closest_to_ebeam&lt;-3.14159265)*(dphi_pho_closest_to_ebeam+2*3.14159265)&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;dphi_pho_closest_to_ebeam = (dphi_pho_closest_to_ebeam&gt;0)*dphi_pho_closest_to_ebeam + (dphi_pho_closest_to_ebeam&lt;0)*(dphi_pho_closest_to_ebeam+2*3.14159265)&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;dphi_pho_closest_to_ebeam = (phi_pho_closest_to_ebeam!=0)*(dphi_pho_closest_to_ebeam)+(phi_pho_closest_to_ebeam==0)*(-1)&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>

<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;e_pho_closest_to_ebeam = (e_pho_closest_to_ebeam&lt;30)*e_pho_closest_to_ebeam + (e_pho_closest_to_ebeam&gt;30)*30&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>

<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;n_towers_40 = (n_towers_40&lt;7)*n_towers_40 + (n_towers_40&gt;=7)*7&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>  <span class="p">)</span>

<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;has_norad = (has_isr==0) and (has_fsr==0)&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-25-4103e232d686&gt;:20: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise in a future error of pandas. Value &#39;[ 0.          0.          0.         ... -2.62005591  0.
  0.        ]&#39; has dtype incompatible with float32, please explicitly cast to a compatible dtype first.
  pandas_df.eval( &#39;dphi_pho_closest_to_ebeam = (abs(dphi_pho_closest_to_ebeam)&lt;3.14159265)*(dphi_pho_closest_to_ebeam)+(dphi_pho_closest_to_ebeam&gt;3.14159265)*(dphi_pho_closest_to_ebeam-2*3.14159265) + (dphi_pho_closest_to_ebeam&lt;-3.14159265)*(dphi_pho_closest_to_ebeam+2*3.14159265)&#39;, inplace=True )
&lt;ipython-input-25-4103e232d686&gt;:26: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise in a future error of pandas. Value &#39;[0 0 0 ... 1 0 0]&#39; has dtype incompatible with int32, please explicitly cast to a compatible dtype first.
  pandas_df.eval( &#39;n_towers_40 = (n_towers_40&lt;7)*n_towers_40 + (n_towers_40&gt;=7)*7&#39;, inplace=True  )
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;obs_ptbal = 1. - obs_e_pt / obs_hfs_pt&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">pandas_df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span> <span class="s1">&#39;obs_pzbal = 1. - (obs_hfs_Empz + obs_e_Empz)/2./beam_e_e&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-6d7bfae1-9bef-435e-b8b6-db1335762b5c" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>has_isr</th>
      <th>has_fsr</th>
      <th>tower_sum_40</th>
      <th>n_towers_40</th>
      <th>eta_pho_closest_to_ebeam</th>
      <th>e_pho_closest_to_ebeam</th>
      <th>phi_pho_closest_to_ebeam</th>
      <th>obs_x</th>
      <th>obs_y</th>
      <th>obs_Q2</th>
      <th>...</th>
      <th>rot_Empz1</th>
      <th>rot_Empz2</th>
      <th>gen_log_x</th>
      <th>gen_log_y</th>
      <th>gen_log_Q2</th>
      <th>e_ecal_over_trk_ratio</th>
      <th>dphi_pho_closest_to_ebeam</th>
      <th>has_norad</th>
      <th>obs_ptbal</th>
      <th>obs_pzbal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-2.582836</td>
      <td>-4.780699</td>
      <td>3.588407</td>
      <td>NaN</td>
      <td>-1.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-4.570547</td>
      <td>-0.797988</td>
      <td>5.435722</td>
      <td>NaN</td>
      <td>-1.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-4.374308</td>
      <td>-2.930975</td>
      <td>4.217414</td>
      <td>NaN</td>
      <td>-1.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-5.914076</td>
      <td>-0.427778</td>
      <td>2.654275</td>
      <td>NaN</td>
      <td>-1.0</td>
      <td>False</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>[0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0]</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-4.279663</td>
      <td>-0.961149</td>
      <td>6.287672</td>
      <td>NaN</td>
      <td>-1.0</td>
      <td>True</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 40 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-6d7bfae1-9bef-435e-b8b6-db1335762b5c')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-6d7bfae1-9bef-435e-b8b6-db1335762b5c button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-6d7bfae1-9bef-435e-b8b6-db1335762b5c');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-e9242eb5-cd36-46eb-925f-4c24138668d5">
      <button class="colab-df-quickchart" onclick="quickchart('df-e9242eb5-cd36-46eb-925f-4c24138668d5')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-e9242eb5-cd36-46eb-925f-4c24138668d5 button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nan_columns</span> <span class="o">=</span> <span class="n">pandas_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">pandas_df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nan_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;e_ecal_over_trk_ratio&#39;, &#39;obs_ptbal&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;has_isr&#39;, &#39;has_fsr&#39;, &#39;tower_sum_40&#39;, &#39;n_towers_40&#39;,
       &#39;eta_pho_closest_to_ebeam&#39;, &#39;e_pho_closest_to_ebeam&#39;,
       &#39;phi_pho_closest_to_ebeam&#39;, &#39;obs_x&#39;, &#39;obs_y&#39;, &#39;obs_Q2&#39;,
       &#39;from_tlv_gen_Q2&#39;, &#39;from_tlv_gen_x&#39;, &#39;from_tlv_gen_y&#39;, &#39;obs_e_e&#39;,
       &#39;obs_e_pz&#39;, &#39;obs_e_pt&#39;, &#39;obs_e_phi&#39;, &#39;obs_hfs_e&#39;, &#39;obs_hfs_pz&#39;,
       &#39;obs_hfs_pt&#39;, &#39;obs_hfs_phi&#39;, &#39;obs_dphi&#39;, &#39;Empz&#39;, &#39;obs_e_trk_e&#39;,
       &#39;beam_e_e&#39;, &#39;obs_hfs_Empz&#39;, &#39;obs_e_Empz&#39;, &#39;obs_event_Empz&#39;, &#39;rot_pt1&#39;,
       &#39;rot_pt2&#39;, &#39;rot_Empz1&#39;, &#39;rot_Empz2&#39;, &#39;gen_log_x&#39;, &#39;gen_log_y&#39;,
       &#39;gen_log_Q2&#39;, &#39;e_ecal_over_trk_ratio&#39;, &#39;dphi_pho_closest_to_ebeam&#39;,
       &#39;has_norad&#39;, &#39;obs_ptbal&#39;, &#39;obs_pzbal&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;e_ecal_over_trk_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_ptbal&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nan_columns</span> <span class="o">=</span> <span class="n">pandas_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">pandas_df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nan_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;has_isr&#39;, &#39;has_fsr&#39;, &#39;tower_sum_40&#39;, &#39;n_towers_40&#39;,
       &#39;eta_pho_closest_to_ebeam&#39;, &#39;e_pho_closest_to_ebeam&#39;,
       &#39;phi_pho_closest_to_ebeam&#39;, &#39;obs_x&#39;, &#39;obs_y&#39;, &#39;obs_Q2&#39;,
       &#39;from_tlv_gen_Q2&#39;, &#39;from_tlv_gen_x&#39;, &#39;from_tlv_gen_y&#39;, &#39;obs_e_e&#39;,
       &#39;obs_e_pz&#39;, &#39;obs_e_pt&#39;, &#39;obs_e_phi&#39;, &#39;obs_hfs_e&#39;, &#39;obs_hfs_pz&#39;,
       &#39;obs_hfs_pt&#39;, &#39;obs_hfs_phi&#39;, &#39;obs_dphi&#39;, &#39;Empz&#39;, &#39;obs_e_trk_e&#39;,
       &#39;beam_e_e&#39;, &#39;obs_hfs_Empz&#39;, &#39;obs_e_Empz&#39;, &#39;obs_event_Empz&#39;, &#39;rot_pt1&#39;,
       &#39;rot_pt2&#39;, &#39;rot_Empz1&#39;, &#39;rot_Empz2&#39;, &#39;gen_log_x&#39;, &#39;gen_log_y&#39;,
       &#39;gen_log_Q2&#39;, &#39;e_ecal_over_trk_ratio&#39;, &#39;dphi_pho_closest_to_ebeam&#39;,
       &#39;has_norad&#39;, &#39;obs_ptbal&#39;, &#39;obs_pzbal&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="apply-any-event-selection-here">
<h2>Apply any event selection here.<a class="headerlink" href="#apply-any-event-selection-here" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas_df</span> <span class="o">=</span> <span class="n">pandas_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;Empz &gt; 0&#39;</span><span class="p">)</span>

<span class="n">pandas_df</span> <span class="o">=</span> <span class="n">pandas_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;obs_event_Empz &gt; 46 and obs_event_Empz &lt; 62&#39;</span><span class="p">)</span>

<span class="n">pandas_df</span> <span class="o">=</span> <span class="n">pandas_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;obs_hfs_pt &gt; 0&#39;</span><span class="p">)</span>

<span class="c1"># We restrict our study to events with Q2&gt;200 GeV2.</span>
<span class="c1"># This kinematic region is well measured, since the electron is scattered into the central regions of the detector.</span>
<span class="c1"># However, no single reconstruction method gives optimal performance over the full phase space</span>
<span class="n">pandas_df</span> <span class="o">=</span> <span class="n">pandas_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;from_tlv_gen_Q2 &gt; 200&#39;</span><span class="p">)</span>

<span class="n">pandas_df</span> <span class="o">=</span> <span class="n">pandas_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;e_ecal_over_trk_ratio &gt; 0&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> Number of entries in pandas_df:  </span><span class="si">%d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">pandas_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Number of entries in pandas_df:  2027827 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-42491537-42a9-401d-8e04-e6ed050c3ddc" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>has_isr</th>
      <th>has_fsr</th>
      <th>tower_sum_40</th>
      <th>n_towers_40</th>
      <th>eta_pho_closest_to_ebeam</th>
      <th>e_pho_closest_to_ebeam</th>
      <th>phi_pho_closest_to_ebeam</th>
      <th>obs_x</th>
      <th>obs_y</th>
      <th>obs_Q2</th>
      <th>...</th>
      <th>rot_Empz1</th>
      <th>rot_Empz2</th>
      <th>gen_log_x</th>
      <th>gen_log_y</th>
      <th>gen_log_Q2</th>
      <th>e_ecal_over_trk_ratio</th>
      <th>dphi_pho_closest_to_ebeam</th>
      <th>has_norad</th>
      <th>obs_ptbal</th>
      <th>obs_pzbal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>23</th>
      <td>0</td>
      <td>0</td>
      <td>24.247692</td>
      <td>1</td>
      <td>-0.182699</td>
      <td>0.144760</td>
      <td>2.422777</td>
      <td>[0.01528253685683012 0.01956743560731411 0.009...</td>
      <td>[0.24758446216583252 0.3492734134197235 0.3492...</td>
      <td>[384.304931640625 694.1551513671875 332.366149...</td>
      <td>...</td>
      <td>-15.735563</td>
      <td>43.001450</td>
      <td>-4.329937</td>
      <td>-1.276337</td>
      <td>5.922210</td>
      <td>1.071315</td>
      <td>0.428013</td>
      <td>True</td>
      <td>0.060719</td>
      <td>-0.101689</td>
    </tr>
    <tr>
      <th>36</th>
      <td>0</td>
      <td>1</td>
      <td>13.348120</td>
      <td>1</td>
      <td>-1.709016</td>
      <td>0.566964</td>
      <td>-0.436204</td>
      <td>[0.0038086669519543648 0.002255246741697192 0....</td>
      <td>[0.5914618968963623 0.5583460927009583 0.55834...</td>
      <td>[228.8004608154297 127.89533233642578 247.3468...</td>
      <td>...</td>
      <td>5.847350</td>
      <td>37.739708</td>
      <td>-5.503805</td>
      <td>-0.571310</td>
      <td>5.453369</td>
      <td>0.988650</td>
      <td>2.755722</td>
      <td>False</td>
      <td>-0.035760</td>
      <td>0.033116</td>
    </tr>
    <tr>
      <th>45</th>
      <td>0</td>
      <td>0</td>
      <td>25.104801</td>
      <td>1</td>
      <td>-0.021559</td>
      <td>1.420366</td>
      <td>2.370969</td>
      <td>[0.013933613896369934 0.01907375641167164 0.00...</td>
      <td>[0.16881048679351807 0.24822576344013214 0.248...</td>
      <td>[238.90234375 480.8838806152344 216.0766296386...</td>
      <td>...</td>
      <td>-22.754414</td>
      <td>42.132053</td>
      <td>-4.499992</td>
      <td>-1.604122</td>
      <td>5.424370</td>
      <td>2.409008</td>
      <td>3.302941</td>
      <td>True</td>
      <td>0.168212</td>
      <td>-0.079415</td>
    </tr>
    <tr>
      <th>47</th>
      <td>0</td>
      <td>1</td>
      <td>20.143602</td>
      <td>1</td>
      <td>0.018809</td>
      <td>0.729400</td>
      <td>-1.816074</td>
      <td>[0.0070611536502838135 0.004471470136195421 0....</td>
      <td>[0.35332125425338745 0.31747934222221375 0.317...</td>
      <td>[253.39761352539062 144.1859588623047 267.4420...</td>
      <td>...</td>
      <td>-12.849410</td>
      <td>37.633305</td>
      <td>-4.799874</td>
      <td>-1.136600</td>
      <td>5.592010</td>
      <td>1.761387</td>
      <td>2.691795</td>
      <td>False</td>
      <td>0.091957</td>
      <td>0.035842</td>
    </tr>
    <tr>
      <th>56</th>
      <td>1</td>
      <td>0</td>
      <td>32.968731</td>
      <td>1</td>
      <td>0.195189</td>
      <td>0.114277</td>
      <td>0.189013</td>
      <td>[0.0923699364066124 0.11394614726305008 0.1276...</td>
      <td>[0.09356395900249481 0.0695156678557396 0.0695...</td>
      <td>[877.8008422851562 804.52490234375 901.0893554...</td>
      <td>...</td>
      <td>-32.666924</td>
      <td>38.093636</td>
      <td>-1.782004</td>
      <td>-2.935359</td>
      <td>6.801494</td>
      <td>0.950580</td>
      <td>3.264253</td>
      <td>False</td>
      <td>0.052082</td>
      <td>0.024048</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 40 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-42491537-42a9-401d-8e04-e6ed050c3ddc')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-42491537-42a9-401d-8e04-e6ed050c3ddc button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-42491537-42a9-401d-8e04-e6ed050c3ddc');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-988c28b5-9cae-45c4-b74f-2e5330f49c72">
      <button class="colab-df-quickchart" onclick="quickchart('df-988c28b5-9cae-45c4-b74f-2e5330f49c72')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-988c28b5-9cae-45c4-b74f-2e5330f49c72 button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas_df</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;from_tlv_gen_x&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_y&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_Q2&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;gen_log_x&#39;</span><span class="p">,</span><span class="s1">&#39;gen_log_y&#39;</span><span class="p">,</span><span class="s1">&#39;gen_log_Q2&#39;</span><span class="p">,</span><span class="s1">&#39;obs_event_Empz&#39;</span><span class="p">,</span>
                        <span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fa34cdfae974672c157282be124f17fa426d251992e5df2fbf422a5d3046068f.png" src="_images/fa34cdfae974672c157282be124f17fa426d251992e5df2fbf422a5d3046068f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas_df</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="p">[</span>
                        <span class="s1">&#39;e_ecal_over_trk_ratio&#39;</span><span class="p">,</span><span class="s1">&#39;n_towers_40&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;eta_pho_closest_to_ebeam&#39;</span><span class="p">,</span><span class="s1">&#39;e_pho_closest_to_ebeam&#39;</span><span class="p">,</span> <span class="s1">&#39;dphi_pho_closest_to_ebeam&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c619954aaede91dc99d5ff32c5c5323b708bc61c89bff9db3508a6f492a1d334.png" src="_images/c619954aaede91dc99d5ff32c5c5323b708bc61c89bff9db3508a6f492a1d334.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas_df</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="p">[</span>
    <span class="s1">&#39;obs_e_Empz&#39;</span><span class="p">,</span><span class="s1">&#39;obs_hfs_Empz&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rot_Empz1&#39;</span><span class="p">,</span>
<span class="c1">#    &#39;rot_Empz2&#39;,</span>
    <span class="s1">&#39;obs_ptbal&#39;</span><span class="p">,</span><span class="s1">&#39;obs_pzbal&#39;</span><span class="p">,</span>
    <span class="s1">&#39;obs_hfs_pt&#39;</span><span class="p">,</span><span class="s1">&#39;obs_e_pt&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rot_pt1&#39;</span><span class="p">,</span><span class="s1">&#39;rot_pt2&#39;</span><span class="p">]</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8cd0a67e247f4c453bf52c20d96eebf602236f5cb80e6c19d9d7a8a2edd2afef.png" src="_images/8cd0a67e247f4c453bf52c20d96eebf602236f5cb80e6c19d9d7a8a2edd2afef.png" />
</div>
</div>
</section>
<section id="set-up-machine-learning">
<h2>Set up machine learning<a class="headerlink" href="#set-up-machine-learning" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CELL 1: Imports and GPU setup</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">TensorDataset</span><span class="p">,</span> <span class="n">DataLoader</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">pickle</span> <span class="kn">import</span> <span class="n">dump</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using device:&quot;</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using device: cuda
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s select the features that are used in the paper</span>

<span class="n">sel_list</span> <span class="o">=</span>  <span class="p">(</span><span class="s1">&#39;e_ecal_over_trk_ratio&#39;</span><span class="p">,</span><span class="s1">&#39;n_towers_40&#39;</span><span class="p">,</span><span class="s1">&#39;eta_pho_closest_to_ebeam&#39;</span><span class="p">,</span><span class="s1">&#39;e_pho_closest_to_ebeam&#39;</span><span class="p">,</span><span class="s1">&#39;dphi_pho_closest_to_ebeam&#39;</span><span class="p">,</span><span class="s1">&#39;obs_e_pz&#39;</span><span class="p">,</span><span class="s1">&#39;obs_e_e&#39;</span><span class="p">,</span><span class="s1">&#39;obs_hfs_pz&#39;</span><span class="p">,</span><span class="s1">&#39;obs_hfs_e&#39;</span><span class="p">,</span> <span class="s1">&#39;rot_pt1&#39;</span><span class="p">,</span> <span class="s1">&#39;rot_Empz1&#39;</span><span class="p">,</span> <span class="s1">&#39;rot_pt2&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_pzbal&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_ptbal&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_dphi&#39;</span><span class="p">)</span>
<span class="n">sel_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sel_list</span><span class="p">)</span>

<span class="n">target_list</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;gen_log_x&#39;</span><span class="p">,</span><span class="s1">&#39;gen_log_Q2&#39;</span><span class="p">,</span><span class="s1">&#39;gen_log_y&#39;</span><span class="p">)</span>
<span class="n">target_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">target_list</span><span class="p">)</span>

<span class="n">sel_X</span> <span class="o">=</span> <span class="n">pandas_df</span><span class="p">[</span><span class="n">sel_list</span><span class="p">]</span>
<span class="n">target_y</span> <span class="o">=</span> <span class="n">pandas_df</span><span class="p">[</span><span class="n">target_list</span><span class="p">]</span>

<span class="n">sub_df</span> <span class="o">=</span> <span class="n">sel_X</span><span class="p">[:</span> <span class="mi">1000</span><span class="p">]</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">sub_df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">sub_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">sub_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c5b45ec241e8f5502a5d2bbfc5c497f21632fb73e166c0b405d917b1835a8e08.png" src="_images/c5b45ec241e8f5502a5d2bbfc5c497f21632fb73e166c0b405d917b1835a8e08.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">sel_X</span><span class="o">.</span><span class="n">values</span>

<span class="n">Y_r</span> <span class="o">=</span> <span class="n">target_y</span><span class="o">.</span><span class="n">values</span>

<span class="n">GY</span> <span class="o">=</span> <span class="n">pandas_df</span><span class="p">[</span><span class="s1">&#39;from_tlv_gen_y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">scalerX</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scalerX</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">scalerX</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">scalerY</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scalerY</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Y_r</span><span class="p">)</span>
<span class="n">Y_r</span> <span class="o">=</span> <span class="n">scalerY</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Y_r</span><span class="p">)</span>

<span class="c1">#-- Save the scaler transformations!  These are essential when reusing the training with a different dataset.</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-scalers&#39;</span> <span class="o">%</span> <span class="n">training_extname</span> <span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  Dir </span><span class="si">%s</span><span class="s1">-scalers already exists</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">training_extname</span> <span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> Saving the input and learning target scalers:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">%s</span><span class="s1">-scalers/input_scaler.pkl&#39;</span> <span class="o">%</span> <span class="n">training_extname</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">%s</span><span class="s1">-scalers/target_scaler.pkl&#39;</span> <span class="o">%</span> <span class="n">training_extname</span> <span class="p">)</span>

<span class="n">dump</span><span class="p">(</span> <span class="n">scalerX</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-scalers/input_scaler.pkl&#39;</span> <span class="o">%</span> <span class="n">training_extname</span> <span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
<span class="n">dump</span><span class="p">(</span> <span class="n">scalerY</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-scalers/target_scaler.pkl&#39;</span> <span class="o">%</span> <span class="n">training_extname</span> <span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_r_train</span><span class="p">,</span> <span class="n">Y_r_test</span><span class="p">,</span> <span class="n">GY_train</span><span class="p">,</span> <span class="n">GY_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span> <span class="n">X</span><span class="p">,</span>  <span class="n">Y_r</span><span class="p">,</span> <span class="n">GY</span><span class="p">,</span>  <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span> <span class="c1">#80/20 split</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Dir /content/drive/My Drive/TMP/training_h1_reg_hugs25_v1-scalers already exists




 Saving the input and learning target scalers:

    /content/drive/My Drive/TMP/training_h1_reg_hugs25_v1-scalers/input_scaler.pkl
    /content/drive/My Drive/TMP/training_h1_reg_hugs25_v1-scalers/target_scaler.pkl
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;numpy.ndarray&#39;&gt; (2027827, 15)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Y_r_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Y_r_test</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GY_train shape: &quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">GY_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GY_test shape: &quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">GY_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1622261, 15) (1622261, 3)
(405566, 15) (405566, 3)
GY_train shape:  (1622261,)
GY_test shape:  (405566,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">j</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># check if we&#39;re still within the number of columns in X</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">],</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>  <span class="c1"># turn off remaining axes</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/da7acc129a3f4a92304de8a760853486a67049c0ea88f91f4b004a1f5043026f.png" src="_images/da7acc129a3f4a92304de8a760853486a67049c0ea88f91f4b004a1f5043026f.png" />
</div>
</div>
</section>
<section id="set-up-the-regression-network">
<h2>Set up the regression network<a class="headerlink" href="#set-up-the-regression-network" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RegressionNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
        <span class="c1">#self.drop1 = nn.Dropout(dropout_setval)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc3</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc4</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc5</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc6</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc7</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc_out</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="c1">#x = self.drop1(x)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">selu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">selu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc3</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">selu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc4</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">selu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc5</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">selu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc6</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">selu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc7</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc_out</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RegressionNet</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate_setval_reg</span><span class="p">,</span> <span class="n">amsgrad</span><span class="o">=</span><span class="n">amsgrad_setval</span><span class="p">)</span>
<span class="n">loss_fn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">HuberLoss</span><span class="p">(</span><span class="n">delta</span><span class="o">=</span><span class="n">delta_setval</span><span class="p">)</span>
<span class="c1"># the Huber loss is used in robust regression,</span>
<span class="c1"># less sensitive to outliers in data than the squared error loss</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># Training loop with early stopping</span>

<span class="n">best_model_name</span> <span class="o">=</span> <span class="n">saving_dir</span> <span class="o">+</span> <span class="s2">&quot;best_model.pt&quot;</span>

<span class="n">early_stop_patience</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># this value is to quickly run the code and can be made larger</span>

<span class="n">train_data</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                           <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">Y_r_train</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">val_data</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                         <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">Y_r_test</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

<span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size_setval</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">val_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">val_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size_setval</span><span class="p">)</span>

<span class="n">best_val_loss</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">patience_counter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">l_train_losses</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">l_val_losses</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_epochs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">================Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_epochs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

    <span class="n">train_losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">val_losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">train_loader_iter</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">xb</span><span class="p">,</span> <span class="n">yb</span> <span class="ow">in</span> <span class="n">train_loader_iter</span><span class="p">:</span>
        <span class="n">xb</span><span class="p">,</span> <span class="n">yb</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">yb</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">xb</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">yb</span><span class="p">)</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>       <span class="c1"># computes gradients</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>      <span class="c1"># updates model parameters with gradients</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span> <span class="c1"># resets all gradients to zero before the next backpropagation step</span>
        <span class="n">train_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

    <span class="c1"># Validation</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">xb</span><span class="p">,</span> <span class="n">yb</span> <span class="ow">in</span> <span class="n">val_loader</span><span class="p">:</span>
            <span class="n">xb</span><span class="p">,</span> <span class="n">yb</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">yb</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">xb</span><span class="p">)</span>
            <span class="n">val_loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">yb</span><span class="p">)</span>
            <span class="n">val_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val_loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

    <span class="n">avg_train_loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">train_losses</span><span class="p">)</span>
    <span class="n">avg_val_loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">val_losses</span><span class="p">)</span>

    <span class="n">l_train_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_train_loss</span><span class="p">)</span>
    <span class="n">l_val_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_val_loss</span><span class="p">)</span>

    <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span><span class="si">}</span><span class="s2"> batches [</span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">s] - loss: </span><span class="si">{</span><span class="n">avg_train_loss</span><span class="si">:</span><span class="s2">1.6f</span><span class="si">}</span><span class="s2"> - val_loss: </span><span class="si">{</span><span class="n">avg_val_loss</span><span class="si">:</span><span class="s2">1.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>



    <span class="c1"># Early stopping logic</span>
    <span class="k">if</span> <span class="n">avg_val_loss</span> <span class="o">&lt;</span> <span class="n">best_val_loss</span><span class="p">:</span>
        <span class="n">best_val_loss</span> <span class="o">=</span> <span class="n">avg_val_loss</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">best_model_name</span><span class="p">)</span>
        <span class="n">patience_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">patience_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">patience_counter</span> <span class="o">&gt;=</span> <span class="n">early_stop_patience</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Early stopping triggered.&quot;</span><span class="p">)</span>
            <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================Epoch 1/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000565 - val_loss: 0.000571

================Epoch 2/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [28s] - loss: 0.000563 - val_loss: 0.000564

================Epoch 3/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [29s] - loss: 0.000559 - val_loss: 0.000559

================Epoch 4/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000557 - val_loss: 0.000558

================Epoch 5/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000555 - val_loss: 0.000554

================Epoch 6/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000553 - val_loss: 0.000560

================Epoch 7/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000550 - val_loss: 0.000565

================Epoch 8/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000548 - val_loss: 0.000550

================Epoch 9/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000546 - val_loss: 0.000548

================Epoch 10/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000545 - val_loss: 0.000549

================Epoch 11/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000542 - val_loss: 0.000547

================Epoch 12/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000541 - val_loss: 0.000546

================Epoch 13/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [24s] - loss: 0.000539 - val_loss: 0.000550

================Epoch 14/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [24s] - loss: 0.000537 - val_loss: 0.000543

================Epoch 15/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [24s] - loss: 0.000536 - val_loss: 0.000538

================Epoch 16/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000535 - val_loss: 0.000544

================Epoch 17/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000533 - val_loss: 0.000554

================Epoch 18/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000531 - val_loss: 0.000551

================Epoch 19/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000530 - val_loss: 0.000540

================Epoch 20/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000529 - val_loss: 0.000531

================Epoch 21/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000528 - val_loss: 0.000528

================Epoch 22/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [24s] - loss: 0.000526 - val_loss: 0.000528

================Epoch 23/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [24s] - loss: 0.000525 - val_loss: 0.000526

================Epoch 24/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000524 - val_loss: 0.000537

================Epoch 25/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000523 - val_loss: 0.000533

================Epoch 26/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000522 - val_loss: 0.000522

================Epoch 27/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [24s] - loss: 0.000521 - val_loss: 0.000524

================Epoch 28/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000520 - val_loss: 0.000527

================Epoch 29/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000519 - val_loss: 0.000523

================Epoch 30/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [24s] - loss: 0.000518 - val_loss: 0.000529

================Epoch 31/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [24s] - loss: 0.000517 - val_loss: 0.000517

================Epoch 32/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [24s] - loss: 0.000516 - val_loss: 0.000521

================Epoch 33/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000515 - val_loss: 0.000518

================Epoch 34/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000515 - val_loss: 0.000515

================Epoch 35/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000513 - val_loss: 0.000516

================Epoch 36/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000513 - val_loss: 0.000525

================Epoch 37/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000512 - val_loss: 0.000521

================Epoch 38/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000511 - val_loss: 0.000511

================Epoch 39/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000511 - val_loss: 0.000513

================Epoch 40/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [24s] - loss: 0.000510 - val_loss: 0.000513

================Epoch 41/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000509 - val_loss: 0.000517

================Epoch 42/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000508 - val_loss: 0.000516

================Epoch 43/50
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1585 batches [25s] - loss: 0.000508 - val_loss: 0.000512
Early stopping triggered.
CPU times: user 17min 28s, sys: 7.19 s, total: 17min 35s
Wall time: 17min 50s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">l_train_losses</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">l_val_losses</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7a1f80727b90&gt;]
</pre></div>
</div>
<img alt="_images/929a2c65c547ec47bcdcf992f20c861a4c49cd75870129288544bc0eafcb540a.png" src="_images/929a2c65c547ec47bcdcf992f20c861a4c49cd75870129288544bc0eafcb540a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save the model weights</span>
<span class="n">filepath_model</span> <span class="o">=</span> <span class="n">training_extname</span> <span class="o">+</span> <span class="s2">&quot;_regression.pt&quot;</span>
<span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">filepath_model</span><span class="p">)</span>

<span class="c1"># Run predictions on test set (already a NumPy array)</span>
<span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">X_test_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">mypreds_r</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_test_tensor</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Avoid divide-by-zero if any target is near 0</span>
<span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-8</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mypreds_r</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">Y_r_test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mypreds_r</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">Y_r_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mypreds_r</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">Y_r_test</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d5e43dfbf2f7d3530c790e25338f10942c4e6e47760e41f546ac7c6e5e9a26c6.png" src="_images/d5e43dfbf2f7d3530c790e25338f10942c4e6e47760e41f546ac7c6e5e9a26c6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">mypreds_r</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">Y_r_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span> <span class="nb">range</span><span class="o">=</span><span class="p">([</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],[</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">]))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">mypreds_r</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">Y_r_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span> <span class="nb">range</span><span class="o">=</span><span class="p">([</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],[</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">]))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">mypreds_r</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">Y_r_test</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span> <span class="nb">range</span><span class="o">=</span><span class="p">([</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],[</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4c4d1a254c611bcf71121ec2f7a8265ba48f46cab602a0c65f59ffcb0147f718.png" src="_images/4c4d1a254c611bcf71121ec2f7a8265ba48f46cab602a0c65f59ffcb0147f718.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">)</span>

<span class="c1"># define titles and x-labels</span>
<span class="n">true_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;log(x$_</span><span class="si">{true}</span><span class="s1">)$&#39;</span><span class="p">,</span> <span class="s1">&#39;log(Q$^2_</span><span class="si">{true}</span><span class="s1">)$&#39;</span><span class="p">,</span> <span class="s1">&#39;log(y$_</span><span class="si">{true}</span><span class="s1">)$&#39;</span><span class="p">]</span>
<span class="n">pred_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;log(x$_{pred.})$&#39;</span><span class="p">,</span> <span class="s1">&#39;log(Q$^2_{pred.})$&#39;</span><span class="p">,</span> <span class="s1">&#39;log(y$_{pred.})$&#39;</span><span class="p">]</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Comparison between true and predicted (scaled) kinematics&quot;</span><span class="p">)</span> <span class="c1"># title for the first row</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Y_r_test</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">true_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># x-label for the upper plots</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mypreds_r</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># x-label for the lower plots</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b154f80b426faa286627bcaf44085400f928a613776388fb4692c83e5f46ef9b.png" src="_images/b154f80b426faa286627bcaf44085400f928a613776388fb4692c83e5f46ef9b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inverse transform to their unscaled values (i.e., before standard scaling)</span>

<span class="n">inv_trans_Y</span> <span class="o">=</span> <span class="n">scalerY</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">Y_r_test</span><span class="p">)</span>
<span class="n">inv_trans_pred</span> <span class="o">=</span> <span class="n">scalerY</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">mypreds_r</span><span class="p">)</span>
<span class="n">true_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">inv_trans_Y</span><span class="p">)</span>
<span class="n">pred_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">inv_trans_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">)</span>

<span class="c1"># define titles and x-labels</span>
<span class="n">true_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x$_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;Q$^2_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;y$_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">]</span>
<span class="n">pred_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x$_{pred.}$&#39;</span><span class="p">,</span> <span class="s1">&#39;Q$^2_{pred.}$&#39;</span><span class="p">,</span> <span class="s1">&#39;y$_{pred.}$&#39;</span><span class="p">]</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Comparison between true and predicted kinematics&quot;</span><span class="p">)</span> <span class="c1"># title for the first row</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">true_vals</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">true_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># x-label for the upper plots</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pred_vals</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">pred_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># x-label for the lower plots</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ea46acc3cce787b5d6403a7363a9f34217019d234f1427bbf7deef43c0362a7f.png" src="_images/ea46acc3cce787b5d6403a7363a9f34217019d234f1427bbf7deef43c0362a7f.png" />
</div>
</div>
</section>
<section id="plots-of-ratio-pred-true-for-target-variables-transformed-log-x-log-y-and-log-q2">
<h2>Plots of Ratio(pred/true) for target variables : transformed log(x), log(y), and log(Q2)<a class="headerlink" href="#plots-of-ratio-pred-true-for-target-variables-transformed-log-x-log-y-and-log-q2" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span>

<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;log(x)$_{pred.}$/log(x)$_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;log(Q$^2_{pred.}$)/log(Q$^2$)$_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;log(y$_{pred.}$)/log(y$_</span><span class="si">{true}</span><span class="s1">$)&#39;</span><span class="p">]</span>
<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_min</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_max</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mypreds_r</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span><span class="o">/</span><span class="n">Y_r_test</span><span class="p">[</span><span class="n">mask</span><span class="p">][:,</span><span class="n">i</span><span class="p">],</span>
                      <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># set column x-label</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">y_min</span><span class="si">}</span><span class="s1">&lt;y$_</span><span class="se">{{</span><span class="s1">true</span><span class="se">}}</span><span class="s1">$&lt;</span><span class="si">{</span><span class="n">y_max</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fc98d2d54aa570fd98d57f3677b882fdff281da75d845640793557651f1e6613.png" src="_images/fc98d2d54aa570fd98d57f3677b882fdff281da75d845640793557651f1e6613.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;log(x)&#39;</span><span class="p">,</span> <span class="s1">&#39;log(Q$^2$)&#39;</span><span class="p">,</span> <span class="s1">&#39;log(y)&#39;</span><span class="p">]</span>
<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_min</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_max</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">Y_r_test</span><span class="p">[</span><span class="n">mask</span><span class="p">][:,</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">mypreds_r</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span>
                        <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span>
                        <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">y_min</span><span class="si">}</span><span class="s1">&lt;y$_</span><span class="se">{{</span><span class="s1">true</span><span class="se">}}</span><span class="s1">$&lt;</span><span class="si">{</span><span class="n">y_max</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; pred.&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; true&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/faf7e5a317aa8fab4e43f585bed022f8941cd4ef431d38b5e913c8ec6b7518a0.png" src="_images/faf7e5a317aa8fab4e43f585bed022f8941cd4ef431d38b5e913c8ec6b7518a0.png" />
</div>
</div>
</section>
<section id="plots-of-predicted-and-true-physics-variable-x">
<h2>Plots of predicted and true physics variable : x<a class="headerlink" href="#plots-of-predicted-and-true-physics-variable-x" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">)</span>

<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_min</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_max</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pred_vals</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">y_min</span><span class="si">}</span><span class="s1">&lt;y$_</span><span class="se">{{</span><span class="s1">true</span><span class="se">}}</span><span class="s1">$&lt;</span><span class="si">{</span><span class="n">y_max</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x$_{pred.}$&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">true_vals</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x$_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9a258b6cf13f9bb5ecf48cbcd703a8a9faeb8b9c08d8e14320786b9933d1bf67.png" src="_images/9a258b6cf13f9bb5ecf48cbcd703a8a9faeb8b9c08d8e14320786b9933d1bf67.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$0.5&lt;y_</span><span class="si">{true}</span><span class="s1">&lt;0.8$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.2&lt;y_</span><span class="si">{true}</span><span class="s1">&lt;0.5$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.1&lt;y_</span><span class="si">{true}</span><span class="s1">&lt;0.2$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.05&lt;y_</span><span class="si">{true}</span><span class="s1">&lt;0.1$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.01&lt;y_</span><span class="si">{true}</span><span class="s1">&lt;0.05$&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_max</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">true_vals</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span> <span class="n">pred_vals</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span>
                 <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">())</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x true&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;x pred.&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/474a2a1fa085b8cd78d3340f070d4eaa4101b752983902e00e7a8b24a97bd2f6.png" src="_images/474a2a1fa085b8cd78d3340f070d4eaa4101b752983902e00e7a8b24a97bd2f6.png" />
</div>
</div>
</section>
<section id="plots-of-predicted-and-true-physics-variable-q2">
<h2>Plots of predicted and true physics variable : Q2<a class="headerlink" href="#plots-of-predicted-and-true-physics-variable-q2" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">)</span>

<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)]</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$0.5&lt;y_</span><span class="si">{true}</span><span class="s1">&lt;0.8$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.2&lt;y_</span><span class="si">{true}</span><span class="s1">&lt;0.5$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.1&lt;y_</span><span class="si">{true}</span><span class="s1">&lt;0.2$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.05&lt;y_</span><span class="si">{true}</span><span class="s1">&lt;0.1$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.01&lt;y_</span><span class="si">{true}</span><span class="s1">&lt;0.05$&#39;</span><span class="p">]</span>
<span class="n">x_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Q$^</span><span class="si">{2}</span><span class="s1">_{pred.}$&#39;</span><span class="p">,</span> <span class="s1">&#39;Q$^</span><span class="si">{2}</span><span class="s1">_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_min</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_max</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pred_vals</span><span class="p">[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">true_vals</span><span class="p">[:,</span><span class="mi">1</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span>
                      <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
          <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># adjust the fontsize of y-axis</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/feb292232995bc9cbbc5d7ebd45078900cd39a7116050909daf65ac4e0560a09.png" src="_images/feb292232995bc9cbbc5d7ebd45078900cd39a7116050909daf65ac4e0560a09.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">axis_max</span> <span class="o">=</span> <span class="mi">2000</span>

<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$0.5 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.8$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.2 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.5$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.1 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.2$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.05 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.1$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.01 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.05$&#39;</span><span class="p">]</span>
<span class="n">x_label</span> <span class="o">=</span> <span class="s1">&#39;Q$^</span><span class="si">{2}</span><span class="s1">$ true&#39;</span>
<span class="n">y_label</span> <span class="o">=</span> <span class="s1">&#39;Q$^</span><span class="si">{2}</span><span class="s1">$ pred.&#39;</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_max</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">true_vals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span> <span class="n">pred_vals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span>
                 <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis_max</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis_max</span><span class="p">]),</span> <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">())</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Q$^</span><span class="si">{2}</span><span class="s1">$ pred.&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2b3c5d1c5e146d1058ba019186ba8ebc649b9f948171cea155b719f0b873f4f4.png" src="_images/2b3c5d1c5e146d1058ba019186ba8ebc649b9f948171cea155b719f0b873f4f4.png" />
</div>
</div>
</section>
<section id="plots-of-predicted-and-true-physics-variable-y">
<h2>Plots of predicted and true physics variable : y<a class="headerlink" href="#plots-of-predicted-and-true-physics-variable-y" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">)</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$0.5 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.8$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.2 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.5$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.1 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.2$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.05 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.1$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.01 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.05$&#39;</span><span class="p">]</span>
<span class="n">x_label</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y$_{pred.}$&#39;</span><span class="p">,</span><span class="s1">&#39;y$_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_max</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pred_vals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">true_vals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6cfe0e20fd1b7b971a52982c1693e1bbe017131ba85ca7c5e3af59f56c6b4b18.png" src="_images/6cfe0e20fd1b7b971a52982c1693e1bbe017131ba85ca7c5e3af59f56c6b4b18.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">axis_max</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$0.5 &lt; y$_</span><span class="si">{true}</span><span class="s1">$ &lt; 0.8$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.2 &lt; y$_</span><span class="si">{true}</span><span class="s1">$ &lt; 0.5$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.1 &lt; y$_</span><span class="si">{true}</span><span class="s1">$ &lt; 0.2$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.05 &lt; y$_</span><span class="si">{true}</span><span class="s1">$ &lt; 0.1$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.01 &lt; y$_</span><span class="si">{true}</span><span class="s1">$ &lt; 0.05$&#39;</span><span class="p">]</span>
<span class="n">x_label</span> <span class="o">=</span> <span class="s1">&#39;y$_</span><span class="si">{true}</span><span class="s1">$&#39;</span>
<span class="n">y_label</span> <span class="o">=</span> <span class="s1">&#39;y$_{pred.}$&#39;</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_max</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">true_vals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span> <span class="n">pred_vals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis_max</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis_max</span><span class="p">]),</span> <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">())</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f8659c9069af9b2530679a11fa12c5825decb2d700addf849572cb0f808d0e8e.png" src="_images/f8659c9069af9b2530679a11fa12c5825decb2d700addf849572cb0f808d0e8e.png" />
</div>
</div>
</section>
<section id="plots-of-pred-true-of-physics-variable-x">
<h2>Plots of pred/true of physics variable x<a class="headerlink" href="#plots-of-pred-true-of-physics-variable-x" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$0.5 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.8$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.2 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.5$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.1 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.2$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.05 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.1$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.01 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.05$&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_max</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pred_vals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">true_vals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x$_{pred.}$ / x$_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7f1bb3eab5bd586b44fa91522fe0d17fec37b4316a7d372b1b653cbe699dd554.png" src="_images/7f1bb3eab5bd586b44fa91522fe0d17fec37b4316a7d372b1b653cbe699dd554.png" />
</div>
</div>
</section>
<section id="plots-of-pred-true-of-physics-variable-q2">
<h2>Plots of pred/true of physics variable Q2<a class="headerlink" href="#plots-of-pred-true-of-physics-variable-q2" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$0.5 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.8$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.2 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.5$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.1 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.2$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.05 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.1$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.01 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.05$&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_max</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pred_vals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">true_vals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Q$^</span><span class="si">{2}</span><span class="s1">_{pred.}$ / Q$^</span><span class="si">{2}</span><span class="s1">_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5ec3e1421a69269614c8ab74a257213928752274ac0a1768939b1aa5e17a7dd6.png" src="_images/5ec3e1421a69269614c8ab74a257213928752274ac0a1768939b1aa5e17a7dd6.png" />
</div>
</div>
</section>
<section id="plots-of-pred-true-of-physics-variable-y">
<h2>Plots of pred/true of physics variable y<a class="headerlink" href="#plots-of-pred-true-of-physics-variable-y" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$0.5 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.8$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.2 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.5$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.1 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.2$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.05 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.1$&#39;</span><span class="p">,</span> <span class="s1">&#39;$0.01 &lt; y_</span><span class="si">{true}</span><span class="s1"> &lt; 0.05$&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_max</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pred_vals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">true_vals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;y$_{pred.}$ / y$_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/678d0a24b0ac616827564ab2e1ec8933e473aef0bc514489d88439a3bc8ec93e.png" src="_images/678d0a24b0ac616827564ab2e1ec8933e473aef0bc514489d88439a3bc8ec93e.png" />
</div>
</div>
</section>
<section id="comparison-plots-of-resolution-for-methods-vs-dnn">
<h2>Comparison plots of resolution for methods vs DNN<a class="headerlink" href="#comparison-plots-of-resolution-for-methods-vs-dnn" title="Link to this heading">#</a></h2>
</section>
<section id="resolution-in-x">
<h2>Resolution in x<a class="headerlink" href="#resolution-in-x" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pandas_df</span><span class="p">[</span><span class="s1">&#39;obs_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9999977    [0.004924382083117962 -0.0046023097820580006 0...
9999984    [0.08789674937725067 0.0698225274682045 0.0582...
9999990    [0.008899795822799206 0.007692348212003708 0.0...
9999991    [0.006072165910154581 -0.004472089000046253 0....
9999996    [0.058499809354543686 0.05831887200474739 0.05...
Name: obs_x, dtype: awkward
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas_df</span><span class="p">[</span><span class="s1">&#39;obs_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>[0.0585,
 0.0583,
 0.0579,
 0.0582,
 0.0586,
 0.0583,
 0.0583,
 0.0583,
 0.0583]
-----------------
backend: cpu
nbytes: 36 B
type: 9 * float32</pre></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pandas_df</span><span class="p">[</span><span class="s1">&#39;obs_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">pandas_df</span><span class="p">[</span><span class="s1">&#39;obs_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.0153, 0.0196, 0.00937, 0.0115, 0.0142, 0.0119, 0.0125, 0.0125, 0.0119]
&lt;class &#39;awkward.highlevel.Array&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># y_ranges = [ (0.5, 0.8), (0.2, 0.5), (0.1, 0.2), (0.05, 0.1), (0.01, 0.05)] #---previously defined</span>

<span class="n">mean_xratio</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rms_xratio</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">cal_mean_rms</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">,</span><span class="n">counts</span><span class="p">,</span> <span class="n">mean_l</span><span class="p">,</span> <span class="n">rms_l</span><span class="p">):</span>
  <span class="n">bin_centers</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">counts</span><span class="p">)</span>
  <span class="n">rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">((</span><span class="n">bin_centers</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">counts</span><span class="p">))</span>
  <span class="n">mean_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
  <span class="n">rms_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rms</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">mean_l</span><span class="p">,</span> <span class="n">rms_l</span>

<span class="n">methods_to_use</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># [5, 4, 3, 0]</span>
<span class="n">methods_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jacquet-Blondel&#39;</span><span class="p">,</span> <span class="s1">&#39;DA method&#39;</span><span class="p">,</span> <span class="s1">&#39;e method&#39;</span><span class="p">,</span> <span class="s1">&#39;Deep NN&#39;</span><span class="p">]</span> <span class="c1">#&#39;I$\Sigma$ method&#39;, &#39;Jacquet-Blondel&#39;, &#39;DA method&#39;, &#39;e method&#39;, &#39;Deep NN&#39;</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">y_cut</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;from_tlv_gen_y&gt;0.50 and from_tlv_gen_y&lt;0.80&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_y&gt;0.20 and from_tlv_gen_y&lt;0.50&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_y&gt;0.10 and from_tlv_gen_y&lt;0.20&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_y&gt;0.05 and from_tlv_gen_y&lt;0.10&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_y&gt;0.01 and from_tlv_gen_y&lt;0.05&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">methods_labels</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># the standard methods</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)):</span>
    <span class="n">mi</span> <span class="o">=</span> <span class="n">methods_to_use</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)):</span>
        <span class="c1">#counts, bin_edges, _ = ax[yi][i].hist(pandas_df.query(y_cut[yi])[&#39;obs_x[%d]&#39; % mi] / pandas_df.query(y_cut[yi])[&#39;from_tlv_gen_x&#39;],</span>
        <span class="c1">#               density=True, bins=100, range=(xmin, xmax))</span>

        <span class="n">counts</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">pandas_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">y_cut</span><span class="p">[</span><span class="n">yi</span><span class="p">])[</span><span class="s1">&#39;obs_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">mi</span><span class="p">])</span> <span class="o">/</span>
            <span class="n">pandas_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">y_cut</span><span class="p">[</span><span class="n">yi</span><span class="p">])[</span><span class="s1">&#39;from_tlv_gen_x&#39;</span><span class="p">],</span>
            <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="n">yi</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
          <span class="n">ax</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">methods_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">mean_xratio</span><span class="p">,</span> <span class="n">rms_xratio</span><span class="o">=</span> <span class="n">cal_mean_rms</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">,</span><span class="n">counts</span><span class="p">,</span> <span class="n">mean_xratio</span><span class="p">,</span> <span class="n">rms_xratio</span><span class="p">)</span>



<span class="c1"># the DNN method</span>
<span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)):</span>
    <span class="n">counts</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pred_vals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">1</span><span class="p">])]</span> <span class="o">/</span> <span class="n">true_vals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">1</span><span class="p">])],</span>
                   <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Deep NN&#39;</span><span class="p">)</span>

    <span class="n">mean_xratio</span><span class="p">,</span> <span class="n">rms_xratio</span><span class="o">=</span> <span class="n">cal_mean_rms</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">,</span><span class="n">counts</span><span class="p">,</span> <span class="n">mean_xratio</span><span class="p">,</span> <span class="n">rms_xratio</span><span class="p">)</span>


<span class="k">for</span> <span class="n">yi</span><span class="p">,</span> <span class="n">y_range</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y_ranges</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; $</span><span class="si">{</span><span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> &lt; y_</span><span class="se">{{</span><span class="s1">true</span><span class="se">}}</span><span class="s1"> &lt; </span><span class="si">{</span><span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">ax</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/$x_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># +1 to include DNN</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4ca147c1b1fd89e9e03147c75fa882cb02402e7cba7a1f894f8590554588a174.png" src="_images/4ca147c1b1fd89e9e03147c75fa882cb02402e7cba7a1f894f8590554588a174.png" />
</div>
</div>
</section>
<section id="resolution-in-q2">
<h2>Resolution in Q2<a class="headerlink" href="#resolution-in-q2" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># y_ranges = [ (0.5, 0.8), (0.2, 0.5), (0.1, 0.2), (0.05, 0.1), (0.01, 0.05)] #---previously defined</span>


<span class="n">mean_Q2ratio</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rms_Q2ratio</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">methods_to_use</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># [5, 4, 3, 0]</span>
<span class="n">methods_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jacquet-Blondel&#39;</span><span class="p">,</span> <span class="s1">&#39;DA method&#39;</span><span class="p">,</span> <span class="s1">&#39;e method&#39;</span><span class="p">,</span> <span class="s1">&#39;Deep NN&#39;</span><span class="p">]</span> <span class="c1">#&#39;I$\Sigma$ method&#39;, &#39;Jacquet-Blondel&#39;, &#39;DA method&#39;, &#39;e method&#39;, &#39;Deep NN&#39;</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">y_cut</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;from_tlv_gen_y&gt;0.50 and from_tlv_gen_y&lt;0.80&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_y&gt;0.20 and from_tlv_gen_y&lt;0.50&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_y&gt;0.10 and from_tlv_gen_y&lt;0.20&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_y&gt;0.05 and from_tlv_gen_y&lt;0.10&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_y&gt;0.01 and from_tlv_gen_y&lt;0.05&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">methods_labels</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># the standard methods</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)):</span>
    <span class="n">mi</span> <span class="o">=</span> <span class="n">methods_to_use</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)):</span>
        <span class="c1">#counts, bin_edges, _ = ax[yi][i].hist(pandas_df.query(y_cut[yi])[&#39;obs_Q2[%d]&#39; % mi] / pandas_df.query(y_cut[yi])[&#39;from_tlv_gen_Q2&#39;],</span>
        <span class="c1">#               density=True, bins=100, range=(xmin, xmax))</span>

        <span class="n">counts</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">pandas_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">y_cut</span><span class="p">[</span><span class="n">yi</span><span class="p">])[</span><span class="s1">&#39;obs_Q2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">mi</span><span class="p">])</span> <span class="o">/</span>
            <span class="n">pandas_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">y_cut</span><span class="p">[</span><span class="n">yi</span><span class="p">])[</span><span class="s1">&#39;from_tlv_gen_Q2&#39;</span><span class="p">],</span>
            <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="n">yi</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
          <span class="n">ax</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">methods_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">mean_Q2ratio</span><span class="p">,</span> <span class="n">rms_Q2ratio</span><span class="o">=</span> <span class="n">cal_mean_rms</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">,</span><span class="n">counts</span><span class="p">,</span> <span class="n">mean_Q2ratio</span><span class="p">,</span> <span class="n">rms_Q2ratio</span><span class="p">)</span>


<span class="c1"># the DNN method</span>
<span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)):</span>
    <span class="n">counts</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span>  <span class="n">ax</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pred_vals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">1</span><span class="p">])]</span> <span class="o">/</span> <span class="n">true_vals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">1</span><span class="p">])],</span>
                   <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Deep NN&#39;</span><span class="p">)</span>

    <span class="n">mean_Q2ratio</span><span class="p">,</span> <span class="n">rms_Q2ratio</span><span class="o">=</span> <span class="n">cal_mean_rms</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">,</span><span class="n">counts</span><span class="p">,</span> <span class="n">mean_Q2ratio</span><span class="p">,</span> <span class="n">rms_Q2ratio</span><span class="p">)</span>


<span class="k">for</span> <span class="n">yi</span><span class="p">,</span> <span class="n">y_range</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y_ranges</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; $</span><span class="si">{</span><span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> &lt; y_</span><span class="se">{{</span><span class="s1">true</span><span class="se">}}</span><span class="s1"> &lt; </span><span class="si">{</span><span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">ax</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Q$^2$/Q$^2_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># +1 to include DNN</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0e882f912f884fa5ba2a320ffce2a6b393f44d1829d3c8dd118534931cfe0935.png" src="_images/0e882f912f884fa5ba2a320ffce2a6b393f44d1829d3c8dd118534931cfe0935.png" />
</div>
</div>
</section>
<section id="resolution-in-y">
<h2>Resolution in y<a class="headerlink" href="#resolution-in-y" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># y_ranges = [ (0.5, 0.8), (0.2, 0.5), (0.1, 0.2), (0.05, 0.1), (0.01, 0.05)] #---previously defined</span>

<span class="n">mean_yratio</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rms_yratio</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">methods_to_use</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># [5, 4, 3, 0]</span>
<span class="n">methods_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jacquet-Blondel&#39;</span><span class="p">,</span> <span class="s1">&#39;DA method&#39;</span><span class="p">,</span> <span class="s1">&#39;e method&#39;</span><span class="p">,</span> <span class="s1">&#39;Deep NN&#39;</span><span class="p">]</span> <span class="c1">#&#39;I$\Sigma$ method&#39;, &#39;Jacquet-Blondel&#39;, &#39;DA method&#39;, &#39;e method&#39;, &#39;Deep NN&#39;</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">y_cut</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;from_tlv_gen_y&gt;0.50 and from_tlv_gen_y&lt;0.80&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_y&gt;0.20 and from_tlv_gen_y&lt;0.50&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_y&gt;0.10 and from_tlv_gen_y&lt;0.20&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_y&gt;0.05 and from_tlv_gen_y&lt;0.10&#39;</span><span class="p">,</span><span class="s1">&#39;from_tlv_gen_y&gt;0.01 and from_tlv_gen_y&lt;0.05&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">methods_labels</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># the standard methods</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)):</span>
    <span class="n">mi</span> <span class="o">=</span> <span class="n">methods_to_use</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)):</span>
        <span class="c1">#counts, bin_edges, _ = ax[yi][i].hist(pandas_df.query(y_cut[yi])[&#39;obs_y[%d]&#39; % mi] / pandas_df.query(y_cut[yi])[&#39;from_tlv_gen_y&#39;],</span>
        <span class="c1">#               density=True, bins=100, range=(xmin, xmax))</span>

        <span class="n">counts</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">pandas_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">y_cut</span><span class="p">[</span><span class="n">yi</span><span class="p">])[</span><span class="s1">&#39;obs_y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">mi</span><span class="p">])</span> <span class="o">/</span>
            <span class="n">pandas_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">y_cut</span><span class="p">[</span><span class="n">yi</span><span class="p">])[</span><span class="s1">&#39;from_tlv_gen_y&#39;</span><span class="p">],</span>
            <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span><span class="p">(</span><span class="n">yi</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
          <span class="n">ax</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">methods_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">mean_yratio</span><span class="p">,</span> <span class="n">rms_yratio</span><span class="o">=</span> <span class="n">cal_mean_rms</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">,</span><span class="n">counts</span><span class="p">,</span> <span class="n">mean_yratio</span><span class="p">,</span> <span class="n">rms_yratio</span><span class="p">)</span>



<span class="c1"># the DNN method</span>
<span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)):</span>
    <span class="n">counts</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pred_vals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">1</span><span class="p">])]</span> <span class="o">/</span> <span class="n">true_vals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][(</span><span class="n">GY_test</span> <span class="o">&gt;</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">GY_test</span> <span class="o">&lt;</span> <span class="n">y_ranges</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">1</span><span class="p">])],</span>
                   <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Deep NN&#39;</span><span class="p">)</span>

    <span class="n">mean_yratio</span><span class="p">,</span> <span class="n">rms_yratio</span><span class="o">=</span> <span class="n">cal_mean_rms</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">,</span><span class="n">counts</span><span class="p">,</span> <span class="n">mean_yratio</span><span class="p">,</span> <span class="n">rms_yratio</span><span class="p">)</span>



<span class="k">for</span> <span class="n">yi</span><span class="p">,</span> <span class="n">y_range</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y_ranges</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">yi</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; $</span><span class="si">{</span><span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> &lt; y_</span><span class="se">{{</span><span class="s1">true</span><span class="se">}}</span><span class="s1"> &lt; </span><span class="si">{</span><span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">ax</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y/y_</span><span class="si">{true}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cut</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">methods_to_use</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># +1 to include DNN</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f8ac644a3d79f752679c53451bb647027134f14ad8d3bbbebbd1fa353d51fd2f.png" src="_images/f8ac644a3d79f752679c53451bb647027134f14ad8d3bbbebbd1fa353d51fd2f.png" />
</div>
</div>
<section id="plotting-the-results-as-a-function-of-y">
<h3>Plotting the results as a function of y<a class="headerlink" href="#plotting-the-results-as-a-function-of-y" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert to numpy arrays for manipulation</span>
<span class="c1"># methods: &#39;Jacquet-Blondel&#39;, &#39;DA method&#39;, &#39;e method&#39;, &#39;Deep NN&#39;</span>

<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)]</span> <span class="c1">#---previously defined</span>

<span class="n">ykin</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">err_ykin</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">y_ranges</span><span class="p">:</span>
  <span class="n">tmp</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">ykin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
  <span class="n">tmp</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">err_ykin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">12.</span><span class="p">))</span>

<span class="n">ykin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ykin</span><span class="p">)</span>
<span class="n">err_ykin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">err_ykin</span><span class="p">)</span>


<span class="n">meanx_jb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_xratio</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
<span class="n">errx_jb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rms_xratio</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>

<span class="n">meanx_da</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_xratio</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
<span class="n">errx_da</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rms_xratio</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>

<span class="n">meanx_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_xratio</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span>
<span class="n">errx_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rms_xratio</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span>

<span class="n">meanx_dnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_xratio</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
<span class="n">errx_dnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rms_xratio</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanx_jb</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Jacquet-Blondel - x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanx_jb</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">err_ykin</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errx_jb</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#label=&#39;uncertainty&#39;</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanx_da</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DA method - x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanx_da</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">err_ykin</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errx_da</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanx_e</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;electron method - x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanx_e</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">err_ykin</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errx_e</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanx_dnn</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DNN - x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanx_dnn</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">err_ykin</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errx_dnn</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;pred. x/true x&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Predicted vs true reconstructed quantities in DIS&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b5144894813156f926defc2b26c72d6738bce31c1aee4389b53f4b8218454eb9.png" src="_images/b5144894813156f926defc2b26c72d6738bce31c1aee4389b53f4b8218454eb9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert to numpy arrays for manipulation</span>
<span class="c1"># methods: &#39;Jacquet-Blondel&#39;, &#39;DA method&#39;, &#39;e method&#39;, &#39;Deep NN&#39;</span>

<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)]</span> <span class="c1">#---previously defined</span>

<span class="n">meanQ2_jb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_Q2ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
<span class="n">errQ2_jb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rms_Q2ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>

<span class="n">meanQ2_da</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_Q2ratio</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
<span class="n">errQ2_da</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rms_Q2ratio</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>

<span class="n">meanQ2_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_Q2ratio</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span>
<span class="n">errQ2_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rms_Q2ratio</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span>

<span class="n">meanQ2_dnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_Q2ratio</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
<span class="n">errQ2_dnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rms_Q2ratio</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanQ2_jb</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Jacquet-Blondel - Q$^</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanQ2_jb</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">err_ykin</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errQ2_jb</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#label=&#39;uncertainty&#39;</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanQ2_da</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DA method - Q$^</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanQ2_da</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">err_ykin</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errQ2_da</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanQ2_e</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;electron method - Q$^</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanQ2_e</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">err_ykin</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errQ2_e</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanQ2_dnn</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DNN - Q$^</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meanQ2_dnn</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">err_ykin</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errQ2_dnn</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;pred. Q$^</span><span class="si">{2}</span><span class="s1">$/true Q$^</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Predicted vs true reconstructed quantities in DIS&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/79de1e7cab0bfec5b97747aa54233be5a3b22e90781be3876f9955c0dc55a676.png" src="_images/79de1e7cab0bfec5b97747aa54233be5a3b22e90781be3876f9955c0dc55a676.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert to numpy arrays for manipulation</span>
<span class="c1"># methods: &#39;Jacquet-Blondel&#39;, &#39;DA method&#39;, &#39;e method&#39;, &#39;Deep NN&#39;</span>

<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)]</span> <span class="c1">#---previously defined</span>


<span class="n">meany_jb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_yratio</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
<span class="n">erry_jb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rms_yratio</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>

<span class="n">meany_da</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_yratio</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
<span class="n">erry_da</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rms_yratio</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>

<span class="n">meany_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_yratio</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span>
<span class="n">erry_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rms_yratio</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span>

<span class="n">meany_dnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_yratio</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
<span class="n">erry_dnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rms_yratio</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meany_jb</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Jacquet-Blondel - y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meany_jb</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">err_ykin</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">erry_jb</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#label=&#39;uncertainty&#39;</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meany_da</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DA method - y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meany_da</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">err_ykin</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">erry_da</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meany_e</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;electron method - y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meany_e</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">err_ykin</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">erry_e</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meany_dnn</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DNN - y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">ykin</span><span class="p">,</span> <span class="n">meany_dnn</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">err_ykin</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">erry_dnn</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;pred. y/true y&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Predicted vs true reconstructed quantities in DIS&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5fd57924e4b10366c54a0d343482f32eaa4ee39bcefdc29bbb11311a6c75d78a.png" src="_images/5fd57924e4b10366c54a0d343482f32eaa4ee39bcefdc29bbb11311a6c75d78a.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cfteach/HUGS2025",
            ref: "webpage-src",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">AI/ML for Nuclear Physics HUGS 2025</p>
      </div>
    </a>
    <a class="right-next"
       href="CNN_HUGS2025_01.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Convolutional Neural Network - Part 1</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-for-h1-rapgap-mc-with-reconstructed-observables-as-input">Training for H1 rapgap MC with reconstructed observables as input.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#this-uses-a-single-dnn-with-all-inputs-electron-hfs-photons">This uses a single DNN with all inputs (electron, HFS, photons)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-any-event-selection-here">Apply any event selection here.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-machine-learning">Set up machine learning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-the-regression-network">Set up the regression network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-ratio-pred-true-for-target-variables-transformed-log-x-log-y-and-log-q2">Plots of Ratio(pred/true) for target variables : transformed log(x), log(y), and log(Q2)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-predicted-and-true-physics-variable-x">Plots of predicted and true physics variable : x</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-predicted-and-true-physics-variable-q2">Plots of predicted and true physics variable : Q2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-predicted-and-true-physics-variable-y">Plots of predicted and true physics variable : y</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-pred-true-of-physics-variable-x">Plots of pred/true of physics variable x</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-pred-true-of-physics-variable-q2">Plots of pred/true of physics variable Q2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plots-of-pred-true-of-physics-variable-y">Plots of pred/true of physics variable y</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-plots-of-resolution-for-methods-vs-dnn">Comparison plots of resolution for methods vs DNN</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resolution-in-x">Resolution in x</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resolution-in-q2">Resolution in Q2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resolution-in-y">Resolution in y</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-results-as-a-function-of-y">Plotting the results as a function of y</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Cristiano Fanelli
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  HUGS2025
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>